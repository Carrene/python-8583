from iso8583.models import Bitmap


def test_bitmap():
    bitmap = Bitmap()
    assert bitmap.size == 64

    assert repr(bitmap) == \
        '0000000000000000000000000000000000000000000000000000000000000000'

    bitmap.set(2)
    bitmap.set(8)
    bitmap.set(7)
    assert repr(bitmap) == \
        '0100001100000000000000000000000000000000000000000000000000000000'

    bitmap.unset(7)
    assert repr(bitmap) == \
        '0100000100000000000000000000000000000000000000000000000000000000'


def test_bitmap_secondary():
    bitmap = Bitmap(secondary=True)
    assert bitmap.size == 128
    assert repr(bitmap) == \
        '1000000000000000000000000000000000000000000000000000000000000000' \
        '0000000000000000000000000000000000000000000000000000000000000000'

    bitmap.set(4)
    bitmap.set(120)
    assert repr(bitmap) == \
        '1001000000000000000000000000000000000000000000000000000000000000' \
        '0000000000000000000000000000000000000000000000000000000100000000'

    bitmap.unset(120)
    assert repr(bitmap) == \
        '1001000000000000000000000000000000000000000000000000000000000000' \
        '0000000000000000000000000000000000000000000000000000000000000000'

    bitmap.set(121)
    bitmap.unset(4)
    assert repr(bitmap) == \
        '1000000000000000000000000000000000000000000000000000000000000000' \
        '0000000000000000000000000000000000000000000000000000000010000000'


def test_bitmap_from_hexstring():
    bitmap = Bitmap.from_hexstring(b'6030050008E10001')
    assert repr(bitmap) == \
	    '0110000000110000000001010000000000001000111000010000000000000001'

